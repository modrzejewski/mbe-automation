# Code Review Findings - machine-learning branch

| File Path | Line Number | Description of the Issue | Severity Level |
| :--- | :--- | :--- | :--- |
| `src/mbe_automation/workflows/training.py` | 136-150 | **Redundant I/O operation.** The function `_crystal_at_pT` saves the MD trajectory to HDF5 and immediately reads it back using `read_structure`. It would be more efficient to return the `Structure`/`Trajectory` object directly from `md.core.run` (or convert the in-memory `traj` object) to avoid unnecessary disk I/O, especially for large trajectories. | Minor |
| `src/mbe_automation/structure/clusters.py` | 231-232 | **Potential runtime error.** The loop `for i in range(system.n_frames)` accesses `system.positions[i]`. If `system.n_frames > 1` but `system.positions` is a 2D array (shape `(N_atoms, 3)`), this will index into atoms rather than frames, causing a crash or incorrect logic. While `Structure` usually enforces 3D arrays for multiple frames, explicit validation or handling (e.g., `if system.positions.ndim == 2: pos = system.positions` else `pos = system.positions[i]`) inside the loop is safer. | Medium |
| `src/mbe_automation/configs/training.py` | 55, 126 | **Inconsistent naming convention.** `PhononSampling` uses `temperature_K` (singular, float) while `MDSampling` uses `temperatures_K` (plural, array). While functionally correct, unifying the naming (e.g., allowing arrays for both or consistently using plural/singular) improves API consistency. | Minor |
| `src/mbe_automation/workflows/training.py` | 64 | **Potential inefficiency.** `detect_molecules` is called on `traj_pbc`, effectively running graph-based molecule detection on every frame. For phonon sampling where connectivity is by definition static (small displacements), detecting on the reference frame and applying the indices to all frames would be significantly faster. | Minor |
